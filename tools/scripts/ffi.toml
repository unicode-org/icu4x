# This file is part of ICU4X. For terms of use, please see the file
# called LICENSE at the top level of the ICU4X source tree
# (online at: https://github.com/unicode-org/icu4x/blob/main/LICENSE ).

# This is a cargo-make file included in the toplevel Makefile.toml

[tasks.test-ffi]
description = "Run FFI tests"
category = "ICU4X Development"
dependencies = [
    "test-capi",
    "test-cpp",
    "test-cortex-ffi",
    "test-nostd",
]

[tasks.test-capi]
description = "Run C API tests"
category = "ICU4X Development"
script_runner = "@duckscript"
script = '''
exit_on_error true
cd ffi/capi/examples/pluralrules
exec make
cd ../fixeddecimal
exec make
cd ../locale
exec make
'''

[tasks.test-cpp]
description = "Run CPP tests"
category = "ICU4X Development"
script_runner = "@duckscript"
script = '''
exit_on_error true
cd ffi/cpp/examples/pluralrules
exec make
cd ../fixeddecimal
exec make
'''

[tasks.test-cppdoc]
description = "Build the cpp tests"
category = "ICU4X Development"
script_runner = "@duckscript"
script = '''
exit_on_error true
cd ffi/cpp/docs;
exec make html
'''

[tasks.test-cortex-ffi]
description = "Build ICU4X CAPI for Cortex"
category = "ICU4X FFI"
toolchain = "nightly"
command = "cargo"
args = ["build", "--package", "icu_capi", "--target", "thumbv7m-none-eabi"]

[tasks.test-nostd]
description = "Ensure ICU4X core builds on no-std"
category = "ICU4X FFI"
toolchain = "nightly"
command = "cargo"
args = ["build", "--package", "icu", "--target", "thumbv7m-none-eabi"]
