// This file is part of ICU4X. For terms of use, please see the file
// called LICENSE at the top level of the ICU4X source tree
// (online at: https://github.com/unicode-org/icu4x/blob/main/LICENSE ).

// This file is automatically @generated by: tools/make/codegen/src/capi_datetime.rs
// It is not intended for manual editing.

#[diplomat::bridge]
#[diplomat::abi_rename = "icu4x_{0}_mv1"]
#[diplomat::attr(auto, namespace = "icu4x")]
pub mod ffi {
    use alloc::boxed::Box;
    use icu_calendar::Gregorian;
    use writeable::Writeable;

    use crate::{
        date::ffi::{Date, IsoDate},
        errors::ffi::DateTimeMismatchedCalendarError,
    };

    #[cfg(feature = "buffer_provider")]
    use crate::provider::ffi::DataProvider;
    #[cfg(any(feature = "compiled_data", feature = "buffer_provider"))]
    use crate::{
        datetime_formatter::ffi::DateTimeLength,
        datetime_options::ffi::{DateTimeAlignment, YearStyle},
        errors::ffi::DateTimeFormatterLoadError,
        locale_core::ffi::Locale,
        neo_datetime::impls::map_or_default,
    };

    #[diplomat::opaque]
    #[diplomat::rust_link(icu::datetime::DateTimeFormatter, Typedef)]
    pub struct DateFormatter(
        pub  icu_datetime::DateTimeFormatter<
            icu_datetime::fieldsets::enums::DateFieldSet,
        >,
    );

    #[diplomat::opaque]
    #[diplomat::rust_link(icu::datetime::FixedCalendarDateTimeFormatter, Typedef)]
    pub struct DateFormatterGregorian(
        pub  icu_datetime::FixedCalendarDateTimeFormatter<
            Gregorian,
            icu_datetime::fieldsets::enums::DateFieldSet,
        >,
    );
    {% for is_gregorian in [false, true] %}
    {%- let ffi_type %}
    {%- let rust_type %}
    {%- if is_gregorian %}
        {%- let ffi_type = "DateFormatterGregorian" %}
        {%- let rust_type = "FixedCalendarDateTimeFormatter" %}
    {%- else %}
        {%- let ffi_type = "DateFormatter" %}
        {%- let rust_type = "DateTimeFormatter" %}
    {%- endif %}
    impl {{ ffi_type }} {
        {%- for variant in variants %}
        {%- for is_with_provider in [false, true] %}
        #[diplomat::attr(all(supports = fallible_constructors, supports = named_constructors), named_constructor = "{{ variant.date_fields.name_lower() }}{% if is_with_provider %}_with_provider{% endif %}")]
        #[diplomat::rust_link(icu::datetime::fieldsets::{{ variant.date_fields.name_upper() }}, Struct)]
        {%- if variant.consumed_options.alignment %}
        #[diplomat::rust_link(icu::datetime::fieldsets::{{ variant.date_fields.name_upper() }}::with_alignment, FnInStruct, compact)]
        {%- endif %}
        {%- if variant.consumed_options.year_style %}
        #[diplomat::rust_link(icu::datetime::fieldsets::{{ variant.date_fields.name_upper() }}::with_year_style, FnInStruct, compact)]
        {%- endif %}
        #[diplomat::rust_link(icu::datetime::fieldsets::{{ variant.date_fields.name_upper() }}::with_length, FnInStruct, compact)]
        #[diplomat::rust_link(icu::datetime::fieldsets::{{ variant.date_fields.name_upper() }}::short, FnInStruct, hidden)]
        #[diplomat::rust_link(icu::datetime::fieldsets::{{ variant.date_fields.name_upper() }}::medium, FnInStruct, hidden)]
        #[diplomat::rust_link(icu::datetime::fieldsets::{{ variant.date_fields.name_upper() }}::long, FnInStruct, hidden)]
        {%- if variant.date_fields.is_default_constructor() && !is_with_provider %}
        #[diplomat::demo(default_constructor)]
        {%- endif %}
        #[cfg(feature = "{% if is_with_provider %}buffer_provider{% else %}compiled_data{% endif %}")]
        pub fn create_{{ variant.date_fields.name_lower() }}{% if is_with_provider %}_with_provider{% endif %}(
            {%- if is_with_provider %}
            provider: &DataProvider,
            {%- endif %}
            locale: &Locale,
            length: Option<DateTimeLength>,
            {%- if variant.consumed_options.alignment %}
            alignment: Option<DateTimeAlignment>,
            {%- endif %}
            {%- if variant.consumed_options.year_style %}
            year_style: Option<YearStyle>,
            {%- endif %}
        ) -> Result<Box<Self>, DateTimeFormatterLoadError> {
            let prefs = (&locale.0).into();
            {%- if !variant.consumed_options.alignment && !variant.consumed_options.year_style %}
            #[allow(unused_mut)]
            {%- endif %}
            let mut options = icu_datetime::fieldsets::{{ variant.date_fields.name_upper() }}::with_length(map_or_default(length));
            {%- if variant.consumed_options.alignment %}
            options.alignment = alignment.map(Into::into);
            {%- endif %}
            {%- if variant.consumed_options.year_style %}
            options.year_style = year_style.map(Into::into);
            {%- endif %}
            Ok(Box::new(Self(
                icu_datetime
                    ::{{ rust_type }}
                    ::try_new{% if is_with_provider %}_with_buffer_provider{% endif %}(
                        {%- if is_with_provider %}
                        provider.get()?,
                        {%- endif %}
                        prefs,
                        options
                    )?
                .cast_into_fset(),
            )))
        }
        {% endfor %}
        {%- endfor %}
        #[diplomat::rust_link(icu::datetime::{{ rust_type }}::format, FnInStruct)]
        #[diplomat::rust_link(icu::datetime::FormattedDateTime, Struct, hidden)]
        #[diplomat::rust_link(icu::datetime::FormattedDateTime::to_string, FnInStruct, hidden)]
        pub fn format_iso(
            &self,
            date: &IsoDate,
            write: &mut diplomat_runtime::DiplomatWrite,
        ) {
            let value = date.0{% if is_gregorian %}.to_calendar(Gregorian){% endif %};
            let _infallible = self.0.format(&value).write_to(write);
        }
        {% if !is_gregorian %}
        #[diplomat::rust_link(icu::datetime::{{ rust_type }}::format_same_calendar, FnInStruct)]
        #[diplomat::rust_link(icu::datetime::FormattedDateTime, Struct, hidden)]
        #[diplomat::rust_link(icu::datetime::FormattedDateTime::to_string, FnInStruct, hidden)]
        pub fn format_same_calendar(
            &self,
            date: &Date,
            write: &mut diplomat_runtime::DiplomatWrite,
        ) -> Result<(), DateTimeMismatchedCalendarError> {
            let value = date.0.wrap_calendar_in_ref();
            let _infallible = self.0.format_same_calendar(&value)?.write_to(write);
            Ok(())
        }
        {%- endif %}
    }
    {% endfor %}
}
